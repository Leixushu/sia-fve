\documentclass[final,leqno,onefignum,onetabnum]{siamltex1213bueler}
% siamltex1213bueler.cls is a two or three line change of siamltex1213.cls to permit
% pdflatex to work and not spew warnings

\usepackage{amssymb,amsmath}

\usepackage{times}

%\theoremstyle{definition}
\newtheorem{example}{Example}
%\newtheorem*{examplecont}{Example, continued}

% math macros
\newcommand\bbf{\mathbf{f}}
\newcommand\bn{\mathbf{n}}
\newcommand\bq{\mathbf{q}}
\newcommand\bv{\mathbf{v}}
\newcommand\by{\mathbf{y}}

\newcommand\bQ{\mathbf{Q}}
\newcommand\bV{\mathbf{V}}
\newcommand\bX{\mathbf{X}}

\newcommand\CC{\mathbb{C}}
\newcommand{\DDt}[1]{\ensuremath{\frac{d #1}{d t}}}
\newcommand{\ddt}[1]{\ensuremath{\frac{\partial #1}{\partial t}}}
\newcommand{\ddx}[1]{\ensuremath{\frac{\partial #1}{\partial x}}}
\newcommand{\ddy}[1]{\ensuremath{\frac{\partial #1}{\partial y}}}
\newcommand{\ddxp}[1]{\ensuremath{\frac{\partial #1}{\partial x'}}}
\newcommand{\ddz}[1]{\ensuremath{\frac{\partial #1}{\partial z}}}
\newcommand{\ddxx}[1]{\ensuremath{\frac{\partial^2 #1}{\partial x^2}}}
\newcommand{\ddyy}[1]{\ensuremath{\frac{\partial^2 #1}{\partial y^2}}}
\newcommand{\ddxy}[1]{\ensuremath{\frac{\partial^2 #1}{\partial x \partial y}}}
\newcommand{\ddzz}[1]{\ensuremath{\frac{\partial^2 #1}{\partial z^2}}}
\newcommand{\Div}{\nabla\cdot}
\newcommand\eps{\epsilon}
\renewcommand{\grad}{\nabla}
\newcommand{\ihat}{\mathbf{i}}
\newcommand{\ip}[2]{\ensuremath{\left<#1,#2\right>}}
\newcommand{\jhat}{\mathbf{j}}
\newcommand{\khat}{\mathbf{k}}
\newcommand{\nhat}{\mathbf{n}}
\newcommand\lam{\lambda}
\newcommand\lap{\triangle}
\newcommand\Matlab{\textsc{Matlab}\xspace}
\newcommand\RR{\mathbb{R}}
\newcommand\vf{\varphi}

\title{Conservation for fluid layers with free boundaries\thanks{Draft date: \today.  Supported by NASA grant \# NNX13AM16G.}} 

\author{Ed Bueler\thanks{Dept.~of Mathematics and Statistics, and Geophysical Institute, University of Alaska Fairbanks (\texttt{elbueler@alaska.edu}).}}

\begin{document}
\maketitle
\slugger{siap}{xxxx}{xx}{x}{x--x}%slugger should be set to mms, siap, sicomp, sicon, sidma, sima, simax, sinum, siopt, sisc, or sirev

\begin{abstract}
FIXME
\end{abstract}

%\begin{keywords}\end{keywords}

%\begin{AMS}\end{AMS}


\pagestyle{myheadings}
\thispagestyle{plain}
\markboth{ED BUELER}{CONSERVATION FOR FLUID LAYERS WITH FREE-BOUNDARIES}


\section{Introduction}  \label{sec:intro}

Consider a fluid which moves over a solid substrate.  Suppose that mass can be added or removed at the boundary of the fluid region, either by a process like precipitation or aggregation, or by phase change if we define the fluid region as being only one phase.  We describe all such addition/removal at the boundary as ``boundary sources.''  Through both flow and boundary sources, the three-dimensional region occupied by the fluid changes in time, thus the problem is of moving-boundary type.  Can a numerical model of such free-boundary fluid motion, with non-material boundary surfaces, conserve the discretized mass of the fluid exactly?  Of course there is nothing special about ``mass'' in the above; can the discretized energy or momentum of a fluid with moving boundary, given boundary source terms, be conserved exactly?

Problems of this type appear for ice sheets \cite{BLKCB,CDDSV,EgholmNielsen2010,JouvetBueler2012}, shallow water flows over marshes \cite{AlonsoSantillanaDawson}, [Dupuit-Forchheimer APPROX IN GROUNDWATER], laboratory flows \cite{Kondic,PeglerWorster2012,SayagWorster2013}, subglacial hydrology \cite{AschwandenBuelerKhroulevBlatter,BuelervanPeltDRAFT,Schoofetal2012}, supraglacial runoff (?), sea ice (?), and tsunami run-up (?), among other applications.  Within the context of ice sheet modeling, discrete mass conservation at free boundaries has a small literature \cite{Albrechtetal2011,JaroschSchoofAnslow2013} which suggests the difficulty of the problem.

Although the above literature relates to the problem we have stated, there is no theoretical guidance as to what degree such exact discrete conservation is possible.  The literature of global climate model addresses exact discrete conservation as a goal [FIXME: CITE], but always in a context without free boundary.  This paper starts a theory of exact discrete conservation for free-boundary fluid problems.

Fluid simulation codes and climate models are obliged to discretize time in some manner, while a rich selection of methods, including finite difference/volume/element methods and grid free spectral methods, are possible when discretizing space.  Thus our approach is to semi-discretize the problem in time by a one-step method and pose each time-step problem in weak variational form.  Each time step is a variational inequality because we look at the simplified case of fluid layers where the layer thickness is well-defined.  The positivity of thickness is the active constraint in the variational inequality form.

We identify the ``retreat area'' during the time step as fundamental.  By definition this area is the set where the fluid layer thickness is positive at the beginning of the time step, and, through flow and boundary-source terms, the thickness is zero at the end of the time step.  That is, fluid was completely lost from the retreat area at some time during the time-step.  Even for well-behaved source terms (e.g.~smooth in time and space) and short time steps, the retreat area can be of essentially arbitrary size.  For example, in a varying climate a large area of thin ice sheet or sea ice can melt, or a large area of a layer of surface water on ground can evaporate, in the duration of one time step no matter how short.  We can state our major assertion informally:
\begin{quote}
\emph{The retreat loss is not exactly balanced by a \emph{modeled} source during the discrete time-step, so a conserving model must track the retreat loss separately.}
\end{quote}

Climate models are ``multiphysics'' models which generally attempt to conserve masses of the phases of water (in particular) separately, as these phases have different physical properties relevant to earth system dynamics.  For example, snow and ice have higher albedo than liquid ocean, and different densities as well.  In such climate multiphysics models with at least one fluid having a moving free boundary, auditable mass conservation does not generally occur.  We believe this will be easier to correct once theoretical limits on discrete conservation are acknowledged, as here.  With the correction term identified here, for example, when a large area of ice sheet or sea-ice melts then the discrete-time model will both have exact conservation of the mass of water in all phases, but also it will be able to correctly report scientificially-essential mass transfers between the phases, as the phases occupy changing two- and three-dimensional regions.


\section{Continuous-time strong formulation}  \label{sec:strongform}

Let $\Omega \subset \RR^d$ be a bounded open region with sufficiently-regular boundary.  The time-dependent model we consider is usually stated in strong form as follows.  It combines a conservation equation, a flux (Neumann) boundary condition, and a constraint:
\begin{align}
u_t + \Div \bq &= f(u,x,t) &&\text{in } \Omega, \text{ where } u > 0 \label{eq:massconserve} \\
\bq \cdot \bn &= g(u,x,t) &&\text{on } \partial\Omega, \text{ where } u > 0 \label{eq:fixedneumann} \\
u &\ge 0 &&\text{in } \bar\Omega. \label{eq:constraint}
\end{align}
We call the unknown $u$ the \emph{layer thickness} $u(x,t)$, and it is defined for $x\in \Omega$ and $t>0$.  The form of the flux $\bq$, that is, how it depends on the unknown $u$ or its gradient $\grad u$, is general for now,
\begin{equation}
\bq = \bq(\grad u,u,x,t), \label{eq:fluxdepends}
\end{equation}
but with more detail below in section \ref{sec:fluxassumptions}.

Constraint \eqref{eq:constraint} comes from the meaning of $u$ as a thickness, which cannot be negative.  We will consider cases where the solution $u$ is continuous (see section \ref{sec:weakform} below, where $u\in W^{1,p}(\Omega)$ with $p>d$), so that the time-dependent support of $u$, namely
   $$\supp u = \{x \big| u(x,t) > 0\} \subset \Omega,$$
is an open set.  We say that the layer exists for $x\in \supp u$, and that it is absent otherwise, though of course $u(x)=0$ is defined for $x\notin \supp u$.  Finding the evolution of this support, and of its free boundary, is essential to problems of this type.

Conservation equation \eqref{eq:massconserve} only applies in this strong form where the layer exists.  Similarly the boundary condition \eqref{eq:fixedneumann} only make sense in locations where $u>0$, at least in the generic case $g\ne 0$.  Well-posedness of the problem \eqref{eq:massconserve}--\eqref{eq:constraint} in fact requires a weak formulation, in which these caveats are replaced by a precise specification of admissible functions, as we do in sections \ref{sec:fluxassumptions} and \ref{sec:weakform}.


\section{Discrete-time strong formulation}  \label{sec:discreteform}

We work with the (time) semi-discretized problem.  Let $\{t_n\}_{n=0}^N$ be a sequence of increasing times on an interval $[0,T]$ with $t_0=0$ and $t_N=T$.  The semi-discretized problem determines $u_n(x) \approx u(x,t_n)$ given old values $u_{n-1}(x)$.  Corresponding to \eqref{eq:massconserve}--\eqref{eq:constraint}, the single-time-step strong form is
\begin{align}
\frac{u_n - u_{n-1}}{\Delta t} + \Div \bQ_n &= F_n &&\text{in } \Omega, \text{ where } u_n > 0 \label{eq:semimassconserve} \\
\bQ_n \cdot \bn &= G_n &&\text{on } \partial\Omega, \text{ where } u_n > 0 \label{eq:semifixedneumann} \\
u_n &\ge 0 &&\text{in } \bar\Omega \label{eq:semiconstraint}
\end{align}
Problem \eqref{eq:semimassconserve}--\eqref{eq:semiconstraint} will be restated as a weak problem in section \ref{sec:weakform}, with attention to well-posedness, with $u_n$ the weak solution.

In equations \eqref{eq:semimassconserve}--\eqref{eq:semiconstraint}, the functions
\begin{align}
 \bQ_n &= \bQ_n(\bX,v,x), \label{eq:Qnfunctionalform} \\
 F_n &= F_n(v,x), \label{eq:Fnfunctionalform} \\
 G_n &= G_n(v,x), \label{eq:Gnfunctionalform}
\end{align}
where $\bX\in\RR^d$ is a vector, $v\ge 0$, and $x\in \Omega$, come from the semi-discretization procedure.  For example, in the simplest implicit case of a backward Euler scheme applied to \eqref{eq:massconserve}--\eqref{eq:constraint}, we have $\bQ_n(\bX,v,x) = \bq(\bX,v,x,t_n)$, $F_n(v,x) = f(v,x,t_n)$, and $G_n(v,x) = g(v,x,t_n)$.  More generally, a $\theta$-method discretization of \eqref{eq:massconserve} with $0\le \theta \le 1$, namely
\begin{align}
  &\frac{u_n - u_{n-1}}{\Delta t} + \theta\, \Div \bq(\grad u_n,u_n,x,t_n) + (1-\theta) \Div \bq(\grad u_{n-1},u_{n-1},x,t_{n-1}) \label{eq:thetamethod} \\
  &\qquad =  \theta f(u_n,x,t_n) + (1-\theta) f(u_{n-1},x,t_{n-1}), \notag
\end{align}
is of form \eqref{eq:semimassconserve} with
\begin{align*}
\bQ_n(\bX,v,x) &= \theta\, \bq(\bX,v,x,t_n), \\
F_n(v,x)       &= \theta f(v,x,t_n) + (1-\theta) f(u_{n-1},x,t_{n-1}) \\
               &\qquad - (1-\theta) \Div \bq(\grad u_{n-1},u_{n-1},x,t_{n-1}), \\
G_n(v,x)       &= g(v,x,t_n).
\end{align*}
Thus, according to the time-semi-discretization procedure, $F_n$ ``absorbs'' all the terms coming from time-discretizing \eqref{eq:semimassconserve}, whether evaluated at times $t_{n-1}$ or time $t_n$, which do not involve the flux $\bq$ evaluated at time $t_n$.

The $\theta=0$ case of \eqref{eq:thetamethod} is the (forward) Euler method, $\theta=1/2$ is the trapezoidal rule, and $\theta=1$ is the backward Euler method.  Though the case of the Euler method, in which $\bQ_n=0$, is completely acceptable in our theory,  we are generally interested in using some implicitness for stability reasons.  Furthermore, our theory based on the weak form of \eqref{eq:semimassconserve}--\eqref{eq:semiconstraint} is not limited to the $\theta$ methods, because other one-step schemes like Runge-Kutta can be put in this form (Appendix), but hypotheses on the flux in the next section may be much harder to check.


\section{Flux assumptions} \label{sec:fluxassumptions}

We make three kinds of assumptions on the discrete-time flux $\bQ_n(\grad u,u,x)$: \begin{itemize}
\item $\bQ_n$ is regular (i.e.~H\"older in $\grad u$, H\"older in $u$ and \eqref{eq:QisLq},
\item for $\bQ_n$, assumption (ii) and maximum principle \eqref{eq:maxprincQn}, and
\item the flux boundary condition $G_n$ is regular (i.e.~in $L^\infty(\partial\Omega)$ and H\"older in $u$
\end{itemize}

FIXME:  want maximum principle property that for every smooth $v(x)$ on $\Omega$, if $\alpha>0$ then
\begin{equation}
v(x) + \alpha\, (\Div \bQ_n)(\grad v,v,x) > 0 \quad \implies \quad v(x) > 0 \label{eq:maxprincQn}
\end{equation}
for all $x\in\Omega$ 

From the contrapositive of \eqref{eq:maxprincQn} applied to $X = \Omega_n^0$, where $u_n=0$ and $u_{n-1}=0$, and because the strong form \eqref{eq:semimassconserve} says that
   $$u_n + \Delta t \Div \bQ_n = u_{n-1} + \Delta t F_n,$$
we have
\begin{equation}
F_n = \Div \bQ_n \le 0  \label{eq:divfluxnonpositive}
\end{equation}
at all points in $\Omega_n^0$.  Also, using the contrapositive of \eqref{eq:maxprincQn} on $X = \Omega_r^n$, where $u_n=0$, and strong form \eqref{eq:semimassconserve}, gives
\begin{equation}
u_{n-1} + \Delta t F_n = \Delta t \Div\bQ_n \le 0  \label{eq:inequalityonretreat}
\end{equation}
at all points in $\Omega_n^r$.

FIXME: if $v \in W^{1,p}(\Omega)$ then, for $1/p + 1/q = 1$,
\begin{equation}
\bQ_n(\grad v,v,x) \in L^q(\Omega) \label{eq:QisLq}
\end{equation}
 

FIXME $\bQ_n(\bX,v,x)$ is continuous in $v$ and $\bQ_n(\bX,0,x)=0$ for all $\bX\in\RR^d$ and $x\in\Omega$.

FIXME: we can extend $G_n$ by zero to the whole of $\partial \Omega$ and not change anything.  On the flip side, as a modeler you are free to put $G_n$ zero anywhere on the boundary, but if it is nonzero then it must be that the solution $u_n$ is actually positive on that part of the boundary


\section{Weak formulation of a time-step}  \label{sec:weakform}

The strong form \eqref{eq:semimassconserve}--\eqref{eq:semiconstraint} is generally understood to be inadequate as a description of $u_n(x)$ because the free boundary is not an integral part of the problem statement.  Here we specify the appropriate function spaces and we propose a weak form, a variational inequality \cite{Friedman,KinderlehrerStampacchia} on a convex space of admissible functions.  This weak form can be proven to be well-posed in some cases.  More generally the weak form can be shown to imply the strong form where $u_n>0$ (``interior condition'').  We start by arguing informally to construct the weak form.\footnote{Though the weak form is mathematically more fundamental, nonetheless history and human frailty have made the strong form more prominent in applications, especially in the climate-modeling literature where our conservation concerns are most relevant.}  Our argument uses facts which are intuitively true on the subsets in decomposition \eqref{eq:omegadecomposition}.

Suppose $u_n\ge 0$ and $v\ge 0$ are sufficiently smooth on $\Omega$ and define $\bQ_n=\bQ_n(\grad u_n,u_n,x)$.  Using \eqref{eq:omegadecomposition} and integration by parts (divergence theorem) we get
\begin{align*}
-\int_{\Omega} \bQ_n \cdot \grad(v-u_n) &= \int_{\Omega_n} (\Div \bQ_n) (v-u_n) - \int_{\partial \Omega_n} (\bQ_n \cdot \bn) (v-u_n) \\
  &\qquad\quad + \int_{\Omega_n^r \cup \Omega_n^0} (\Div \bQ_n) (v-u_n) - \int_{\partial(\Omega_n^r \cup \Omega_n^0)} (\bQ_n \cdot \bn) (v-u_n).
\end{align*}
Because $u_n$ is continuous, $u_n=0$ along $\Gamma_n^0$ so it follows from assumption (ii) and equation \eqref{eq:semifixedneumann} that
       $$\int_{\partial \Omega_n} (\bQ_n \cdot \bn) (v-u_n) = \int_{\Gamma_n^N} G_n (v-u_n).$$
Similarly,
       $$\int_{\partial(\Omega_n^r \cup \Omega_n^0)} (\bQ_n \cdot \bn) (v-u_n) = 0.$$
By using \eqref{eq:semimassconserve} and by extending $G_n$ by zero to all of $\partial \Omega$ we get
\begin{align}
-\int_{\Omega} \bQ_n \cdot \grad(v-u_n) &= \int_{\Omega_n} \left(F_n - \frac{u_n - u_{n-1}}{\Delta t}\right) (v-u_n) - \int_{\partial \Omega} G_n (v-u_n) \label{eq:equalitybeforeVI} \\
  &\qquad\quad + \int_{\Omega_n^r \cup \Omega_n^0} (\Div \bQ_n) (v-u_n). \notag
\end{align}

However, by assumption (ii) we have $\Div \bQ_n=0$ on $\Omega_n^0$ so
    $$\int_{\Omega_n^0} (\Div \bQ_n) (v-u_n) = 0 \ge \int_{\Omega_n^0} \left(F_n - \frac{u_n - u_{n-1}}{\Delta t}\right) (v-u_n),$$
because in fact $u_n=u_{n-1}=0$ and $v-u_n = v \ge 0$ on $\Omega_n^0$, and because \eqref{eq:divfluxnonpositive} says that $F_n \le 0$ on $\Omega_n^0$.  Almost the same, by assumption (ii) on $\Omega_n^r$,
    $$\int_{\Omega_n^r} (\Div \bQ_n) (v-u_n) = 0 \ge \int_{\Omega_n^r} \left(F_n - \frac{u_n - u_{n-1}}{\Delta t}\right) (v-u_n)$$
because $u_n=0$ and $v-u_n = v \ge 0$ on $\Omega_n^r$, and because \eqref{eq:inequalityonretreat} says that $F_n - (u_n - u_{n-1})/\Delta t = F_n + u_{n-1}/\Delta t \le 0$ on $\Omega_n^r$.  Thus if we return to \eqref{eq:equalitybeforeVI} we have
\begin{align}
-\int_{\Omega} \bQ_n \cdot \grad(v-u_n) &\ge \int_{\Omega_n} \left(F_n - \frac{u_n - u_{n-1}}{\Delta t}\right) (v-u_n) - \int_{\partial \Omega} G_n (v-u_n) \label{eq:essentiallyVI} \\
  &\qquad\quad + \int_{\Omega_n^r \cup \Omega_n^0} \left(F_n - \frac{u_n - u_{n-1}}{\Delta t}\right) (v-u_n). \notag
\end{align}

We want to weakly-pose our problem so that the decomposition $\Omega = \Omega_n \cup \Omega_n^r \cup \Omega_n^0$ does not appear, as this decomposition arises from knowing the solution $u_n$.  But \eqref{eq:essentiallyVI} can be written without the decomposition:
\begin{equation}
-\int_{\Omega} \bQ_n \cdot \grad(v-u_n) \ge \int_{\Omega} \left(F_n - \frac{u_n - u_{n-1}}{\Delta t}\right) (v-u_n) - \int_{\partial \Omega} G_n (v-u_n) \label{eq:morallytheVI}
\end{equation}
This is our variational inequality weak form.

\medskip
\begin{definition}  Fix $p>1$.  Let
    $$\mathcal{K} = \left\{v \in W^{1,p}(\Omega) \,\big|\, v(x) \ge 0 \text{ for all } x \in \Omega\right\}.$$
\end{definition}

\begin{definition}  We say $u_n \in \mathcal{K}$ solves the \emph{single-time-step weak problem} if 
\begin{align}
&\int_{\Omega} u_n (v-u_n) - \Delta t\, \bQ_n \cdot \grad(v-u_n)  \label{eq:theVI} \\
  &\qquad\qquad \ge \int_{\Omega} \left(u_{n-1} + \Delta t F_n\right) (v-u_n) - \Delta t \int_{\partial \Omega} G_n (v-u_n)\notag
\end{align}
for all $v \in \mathcal{K}$.
\end{definition}

FIXME:  We will show that in some cases this is well-posed

FIXME:  We will show [ONLY IF $\bQ_n$ HAS $\grad u_n$] that along the free boundary $\Gamma_n^0$ we have both $u_n=0$ and $\bQ_n = 0$.


\section{The retreat set and the retreat loss}  \label{sec:retreatdefn}

From \eqref{eq:semimassconserve}--\eqref{eq:semiconstraint} we decompose $\Omega$ into three disjoint regions based on $u_n$ and $u_{n-1}$:
\begin{align*}
\Omega_n &= \left\{x \in \Omega \,\big|\, u_n(x)>0\right\}, \\
\Omega_n^r &= \left\{x \in \Omega \,\big|\, u_n(x)=0 \text{ and } u_{n-1}(x) > 0\right\}, \\
\Omega_n^0 &= \left\{x \in \Omega \,\big|\, u_n(x)=0 \text{ and } u_{n-1}(x) = 0\right\},
\end{align*}
so that
\begin{equation}
\Omega = \Omega_n \cup \Omega_n^r \cup \Omega_n^0.  \label{eq:omegadecomposition}
\end{equation}
Here the superscript ``$r$'' stands for ``retreat,''\footnote{At this point a symmetry has been broken.  We could have decomposed $\Omega= \Omega_n \cup \Omega_n^a \cup \Omega_n^0$ where $\Omega_n^a = \{u_n(x) > 0 \text{ and } u_{n-1}(x) = 0\}$ is the ``advance'' set.  As far as we can tell the resulting alternate theory offers no advantages or disadvantages.} and $\Omega_n^r$ is called the \emph{retreat set}.

Figure \ref{fig:domains} shows this decomposition of $\Omega$.  In this section we simply define the quantities needed to precisely restate the major assertion of section \ref{sec:intro}.  A decomposition of the boundary $\partial \Omega$ is needed to define the quantities.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=2.0in,keepaspectratio=true]{domains-fig}
\end{center}
\caption{We decompose $\Omega = \Omega_n \cup \Omega_n^r \cup \Omega_n^0$, where $\Omega_n$ the support of $u_n$, $\Omega_n^r$ is the retreat set, and $\Omega_n^0$ is the set on which both $u_{n-1}$ and $u_n$ are zero.  The boundary of $\Omega_n$ is decomposed into two pieces, $\partial\Omega_n = \Gamma_n^N \cup \Gamma_n^0$.}
\label{fig:domains}
\end{figure}

The boundary of the support $\Omega_n$ of $u_n$ decomposes disjointly into the part where a fixed (Neumann) condition applies, and a part which is the free boundary.  Let $\Gamma_n^0 = \Omega \cap \partial \Omega_n$ and $\Gamma_n^N = \partial \Omega \cap \partial \Omega_n$, where superscript ``$N$'' stands for ``Neumann.''  Then
\begin{align*}
\partial\Omega_n &= \Gamma_n^N \cup \Gamma_n^0
\end{align*}
Along $\Gamma_n^N$ the flux condition \eqref{eq:semifixedneumann} applies.

Now define
\begin{equation}
M_n = \int_\Omega u_n(x)\,dx = \int_{\Omega_n} u_n(x)\,dx, \label{eq:totalmassdefn}
\end{equation}
which we naturally call the \emph{(total) mass} at time $t_n$, and define
\begin{equation}
R_n = \int_{\Omega_n^r} u_{n-1}\,dx, \label{eq:retreatlossdefn}
\end{equation}
which we call the \emph{retreat loss} at time $t_n$.  The total mass and the retreat loss at time $t_n$ are related.  In fact, by \eqref{eq:semimassconserve}, \eqref{eq:totalmassdefn}, and \eqref{eq:retreatlossdefn} we have
\begin{align}
M_n - M_{n-1} &=  - \int_{\Omega_n^r} u_{n-1}\,dx + \int_{\Omega_n} (u_n - u_{n-1})\,dx \label{eq:massstep} \\
   &= - R_n + \Delta t \int_{\Omega_n} (- \Div \bQ_n + F_n) \,dx \notag \\
   &= - R_n + \Delta t \int_{\Gamma_n^N} G_n + \Delta t \int_{\Omega_n} F_n\,dx \notag
\end{align}
because $\bQ_n=0$ along $\Gamma_n^0$ by assumption (ii).

Given the continuous-time solution $u(x,t)$ to problem \eqref{eq:massconserve}--\eqref{eq:constraint} starting with initial condition $u(x,t_{n-1}) = u_{n-1}(x)$, at points $x$ within $\Omega_n^r$ we could define the time at which $u(x,t)$ first becomes zero.  This \emph{time-of-loss function} is well-defined on the retreat set $\Omega_n^r$:
\begin{equation}
\bar t(x) = \inf\left\{t \,\big|\, u(x,t)>0 \,\text{ and }\, t_{n-1} < t \le t_n\right\}.
\end{equation}
While $\bar t(x)$ varies over $\Omega_n^r$, as $\Delta t \to 0$ then $\bar t(x) \to t_{n-1}$.  We might even expect that the area of $\Omega_n^r$ might decrease to zero as $\Delta t \to 0$, though this has not been proven.  But for numerical models, which necessarily have discrete time, the variation in $\bar t(x)$, over $\Omega_n^r$ during the time-step $t_{n-1} < t \le t_n$, is unknown.  Not accounting for the unknown variation of $\bar t(x)$ over the retreat set $\Omega_n^r$ is a barrier to the conservation of discrete (or merely time-discretized) modeled mass.

As an operational statement about discrete-time models, we can rephrase our major assertion from section \ref{sec:intro} as
\begin{quote}
\emph{The model must store a time series for $R_n$, in addition to the expected time series $\int_{\Gamma_n^N} G_n$ and $\int_{\Omega_n} F_n$, in order to provide auditable mass conservation.}
\end{quote}
In stating this assertion, we note that the retreat loss $R_n$ should vanish in the $\Delta t\to 0$ limit, which is a consistency statement about the time-discretized model.


\section{Examples and non-examples} \label{sec:examples}

In this section FIXME

\begin{example}  Let $v_0>0$ and $f_0>0$ be scales for the velocity and source term.  Consider an advecting-layer problem in one dimension, with constant velocity.  That is, if $q = v_0 u$ then the strong form problem for $u(t,x)$ is
\begin{equation}
u_t + v_0 u_x = f(x) \quad \text{ subject to } \quad u\ge 0.  \label{eq:ex:advectlayer}
\end{equation}
Specifically, suppose $x\in[0,L]$ and periodic boundary conditions $u(t,0)=u(t,L)$ and $u_x(t,0)=u_x(t,L)$.  For the source term, consider this particular source that is negative on average:
    $$f(x) = f_0 \left(\sin\left(\frac{2\pi x}{L}\right) - \frac{1}{5}\right).$$

If $\tilde u(t,x)$ solves the same problem without the constraint, and if $\tilde M(t) = \int_0^L \tilde u(t,x)\,dx$ is the continuous-time mass for the unconstrained problem then
    $$\dot{\tilde M}(t) = \int_0^L f(x)\,dx = -\frac{f_0 L}{5} < 0$$
so $\tilde M(t)$ goes to $-\infty$ as a linear function in $t$.

But the constrained solution $u(t,x)$ and the total mass $M(t) = \int_0^L u(t,x)\,dx$ approach finite limits which are independent of the initial state $u(0,x)$.  FIXME: prove this?
\end{example}

\section{Conclusion} \label{sec:conclusion}  FIXME


%         References
\bibliography{lc}
\bibliographystyle{siam}


\Appendix

\section{Second-order Runge-Kutta time-discretization}   In Section \ref{sec:discreteform} we describe the time semi-discretization of the continuum strong form \eqref{eq:massconserve}--\eqref{eq:constraint} using the $\theta$ method, thus including the Euler, backward Euler, and trapezoidal rules.  These time-discretizations generate particular forms for functions $\bQ_n(\bX,v,z),F_n(v,z),G_n(v,z)$, which appear in single-time-step strong form equations \eqref{eq:semimassconserve}--\eqref{eq:semiconstraint}, and which reappear in the single-time-step variational inequality problem \eqref{eq:theVI}.

In this Appendix we illustrate how these functions can be generated for Runge-Kutta (RK) schemes, although in some cases at the cost of having to solve multiple problems of type \eqref{eq:theVI} at each time step.  Higher-order RK schemes could also be addressed without any additional ideas, but we limit our presentation to second-order this for simplicity.

For the $m$-dimensional ODE system
  $$\by' = \bbf(t,\by),$$
every two stage RK scheme with time-step $h=\Delta t$ can be written with Butcher tableau \cite{AscherPetzold}
  $$
\begin{array}{c|cc}
\tau_1 & a_{11} & a_{12}  \\
\tau_2 & a_{21} & a_{22}  \\ \hline
       & b_1   & b_2  \\
\end{array}$$
representing the formulas
  $$\by_{n,i} = \by_{n-1} + h \sum_{j=1}^2 a_{ij} \bbf(t_{n-1} + \tau_j h, \by_{n,j})$$
for $i=1,2$, and
  $$\by_n = \by_{n-1} + h \sum_{i=1}^2 b_i \bbf(t_{n-1} + \tau_i h, \by_{n,i}).$$
\emph{Explicit} methods have $a_{ij}=0$ for $j\ge i$ (i.e.~zeros on and above the diagonal), \emph{semi-implicit} methods have only $a_{12}=0$, and \emph{diagonally-implicit} methods are semi-implicit methods for which $a_{11}=a_{22}$, by definition \cite{Alexander1977}.  We consider only semi-implicit methods in this paper.  For example, the $\theta$-methods used in Section \ref{sec:discreteform} have tableau
  $$
\begin{array}{c|cc}
0 &          &   \\
1 & 1-\theta & \theta  \\ \hline
  & 1-\theta & \theta  \\
\end{array}$$
Note that $\theta>0$ methods are semi-implicit but not not diagonally-implicit.

Diagonally-implicit $s$-stage RK methods have the well-known advantage, especially in the case of large $m$ arising from discretization of partial differential equations, that the matrix $A$ used in solving the discrete system, or its linearization, can be re-used at each stage because it is of the $i$-independent form $A \bu = \bb$ where $A = I - h a_{ii} \partial f/\partial y$ \cite{Alexander1977,AscherPetzold}.  Furthermore, there exists a strongly S-stable \cite{Alexander1977}, which has stiff decay \cite{AscherPetzold}, with two stages and order of accuracy two.  

FIXME: DIRK(2,2) is strongly S-stable \cite{Alexander1977}

\end{document}
